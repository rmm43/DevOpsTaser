<?xml version="1.0" encoding="utf-8"?>
<jdoc cUnit="net.sf.jabref.export.ExportFormat" jls="java5">
<jent id="0" type="file" span="0:0:367:1">Source/jabref/src/java/net/sf/jabref/export/ExportFormat.java</jent>
<jent id="1" pid="0" type="class" span="21:1:367:1">net.sf.jabref.export.ExportFormat</jent>
<jent id="2" pid="1" type="method" span="49:2:56:2">net.sf.jabref.export.ExportFormat.ExportFormat(String,String,String,String,String)</jent>
<jent id="3" pid="1" type="method" span="59:2:61:2">net.sf.jabref.export.ExportFormat.ExportFormat()</jent>
<jent id="4" pid="1" type="method" span="71:2:73:2">net.sf.jabref.export.ExportFormat.setCustomExport(boolean)</jent>
<jent id="5" pid="1" type="method" span="78:2:80:2">net.sf.jabref.export.ExportFormat.getConsoleName()</jent>
<jent id="6" pid="1" type="method" span="85:2:87:2">net.sf.jabref.export.ExportFormat.getDisplayName()</jent>
<jent id="7" pid="1" type="method" span="94:5:96:5">net.sf.jabref.export.ExportFormat.setEncoding(String)</jent>
<jent id="8" pid="1" type="method" span="115:2:125:2">net.sf.jabref.export.ExportFormat.getReader(String)</jent>
<jent id="9" pid="1" type="method" span="151:2:290:2">net.sf.jabref.export.ExportFormat.performExport(BibtexDatabase,MetaData,String,String,Set&lt;String&gt;)</jent>
<jent id="10" pid="1" type="method" span="297:5:342:5">net.sf.jabref.export.ExportFormat.readFormatterFile(String)</jent>
<jent id="11" pid="1" type="method" span="344:5:347:2">net.sf.jabref.export.ExportFormat.getSaveSession(String,File)</jent>
<jent id="12" pid="1" type="method" span="352:2:356:2">net.sf.jabref.export.ExportFormat.getFileFilter()</jent>
<jent id="13" pid="1" type="method" span="358:2:366:2">net.sf.jabref.export.ExportFormat.finalizeSaveSession(SaveSession)</jent>
<jtok eid="0" type="block_comment" span="17:1:20:4">/**
 * Base class for export formats based on templates.
 * 
 */</jtok>
<jtok eid="1" type="class_name" span="21:14:21:26">ExportFormat</jtok>
<jtok eid="1" type="class_or_interface_ref" span="21:38:21:51">IExportFormat</jtok>
<jtok eid="1" type="class_or_interface_ref" span="23:2:23:8">String</jtok>
<jtok eid="1" type="field_name" span="23:9:23:20">displayName</jtok>
<jtok eid="1" type="class_or_interface_ref" span="24:2:24:8">String</jtok>
<jtok eid="1" type="field_name" span="24:9:24:20">consoleName</jtok>
<jtok eid="1" type="class_or_interface_ref" span="25:2:25:8">String</jtok>
<jtok eid="1" type="field_name" span="25:9:25:19">lfFileName</jtok>
<jtok eid="1" type="class_or_interface_ref" span="26:2:26:8">String</jtok>
<jtok eid="1" type="field_name" span="26:9:26:18">directory</jtok>
<jtok eid="1" type="class_or_interface_ref" span="27:2:27:8">String</jtok>
<jtok eid="1" type="field_name" span="27:9:27:18">extension</jtok>
<jtok eid="1" type="class_or_interface_ref" span="28:5:28:11">String</jtok>
<jtok eid="1" type="field_name" span="28:12:28:20">encoding</jtok>
<jtok eid="1" type="line_comment" span="28:29:28:81">// If this value is set, it will be used to override</jtok>
<jtok eid="1" type="line_comment" span="29:7:29:49">// the default encoding for the basePanel.</jtok>
<jtok eid="1" type="class_or_interface_ref" span="31:2:31:12">FileFilter</jtok>
<jtok eid="1" type="field_name" span="31:13:31:23">fileFilter</jtok>
<jtok eid="1" type="field_name" span="32:10:32:22">customExport</jtok>
<jtok eid="1" type="block_comment" span="34:2:48:5">/**
	 * Initialize another export format based on templates stored in dir with
	 * layoutFile lfFilename.
	 * 
	 * @param displayName
	 *            Name to display to the user.
	 * @param consoleName
	 *            Name to call this format in the console.
	 * @param lfFileName
	 *            Name of the main layout file.
	 * @param directory
	 *            Directory in which to find the layout file.
	 * @param extension
	 *            Should contain the . (for instance .txt).
	 */</jtok>
<jtok eid="2" type="method_name" span="49:9:49:21">ExportFormat</jtok>
<jtok eid="2" type="parameter_type" span="49:22:49:28">String</jtok>
<jtok eid="2" type="parameter_name" span="49:29:49:40">displayName</jtok>
<jtok eid="2" type="parameter_type" span="49:42:49:48">String</jtok>
<jtok eid="2" type="parameter_name" span="49:49:49:60">consoleName</jtok>
<jtok eid="2" type="parameter_type" span="50:3:50:9">String</jtok>
<jtok eid="2" type="parameter_name" span="50:10:50:20">lfFileName</jtok>
<jtok eid="2" type="parameter_type" span="50:22:50:28">String</jtok>
<jtok eid="2" type="parameter_name" span="50:29:50:38">directory</jtok>
<jtok eid="2" type="parameter_type" span="50:40:50:46">String</jtok>
<jtok eid="2" type="parameter_name" span="50:47:50:56">extension</jtok>
<jtok eid="2" type="qualified_name_ref" span="51:8:51:19">displayName</jtok>
<jtok eid="2" type="primary_name_ref" span="51:22:51:33">displayName</jtok>
<jtok eid="2" type="qualified_name_ref" span="52:8:52:19">consoleName</jtok>
<jtok eid="2" type="primary_name_ref" span="52:22:52:33">consoleName</jtok>
<jtok eid="2" type="qualified_name_ref" span="53:8:53:18">lfFileName</jtok>
<jtok eid="2" type="primary_name_ref" span="53:21:53:31">lfFileName</jtok>
<jtok eid="2" type="qualified_name_ref" span="54:8:54:17">directory</jtok>
<jtok eid="2" type="primary_name_ref" span="54:20:54:29">directory</jtok>
<jtok eid="2" type="qualified_name_ref" span="55:8:55:17">extension</jtok>
<jtok eid="2" type="primary_name_ref" span="55:20:55:29">extension</jtok>
<jtok eid="1" type="block_comment" span="58:2:58:49">/** Empty default constructor for subclasses */</jtok>
<jtok eid="3" type="method_name" span="59:12:59:24">ExportFormat</jtok>
<jtok eid="3" type="line_comment" span="60:3:60:25">// intentionally empty</jtok>
<jtok eid="1" type="block_comment" span="63:2:70:5">/**
	 * Indicate whether this is a custom export. A custom export looks for its
	 * layout files using a normal file path, while a built-in export looks in
	 * the classpath.
	 * 
	 * @param custom
	 *            true to indicate a custom export format.
	 */</jtok>
<jtok eid="4" type="method_name" span="71:14:71:29">setCustomExport</jtok>
<jtok eid="4" type="parameter_name" span="71:38:71:44">custom</jtok>
<jtok eid="4" type="qualified_name_ref" span="72:8:72:20">customExport</jtok>
<jtok eid="4" type="primary_name_ref" span="72:23:72:29">custom</jtok>
<jtok eid="1" type="block_comment" span="75:2:77:5">/**
	 * @see IExportFormat#getConsoleName()
	 */</jtok>
<jtok eid="5" type="class_or_interface_ref" span="78:9:78:15">String</jtok>
<jtok eid="5" type="method_name" span="78:16:78:30">getConsoleName</jtok>
<jtok eid="5" type="primary_name_ref" span="79:10:79:21">consoleName</jtok>
<jtok eid="1" type="block_comment" span="82:2:84:5">/**
	 * @see IExportFormat#getDisplayName()
	 */</jtok>
<jtok eid="6" type="class_or_interface_ref" span="85:9:85:15">String</jtok>
<jtok eid="6" type="method_name" span="85:16:85:30">getDisplayName</jtok>
<jtok eid="6" type="primary_name_ref" span="86:10:86:21">displayName</jtok>
<jtok eid="1" type="block_comment" span="89:5:93:8">/**
     * Set an encoding which will be used in preference to the default value
     * obtained from the basepanel.
     * @param encoding The name of the encoding to use.
     */</jtok>
<jtok eid="7" type="method_name" span="94:20:94:31">setEncoding</jtok>
<jtok eid="7" type="parameter_type" span="94:32:94:38">String</jtok>
<jtok eid="7" type="parameter_name" span="94:39:94:47">encoding</jtok>
<jtok eid="7" type="qualified_name_ref" span="95:14:95:22">encoding</jtok>
<jtok eid="7" type="primary_name_ref" span="95:25:95:33">encoding</jtok>
<jtok eid="1" type="block_comment" span="98:5:114:5">/**
	 * This method should return a reader from which the given layout file can
	 * be read.
	 * 
	 * This standard implementation of this method will use the
	 * {@link FileActions#getReader(String)} method.
	 * 
	 * Subclasses of ExportFormat are free to override and provide their own
	 * implementation.
	 * 
	 * @param filename
	 *            the file name
	 * @throws IOException
	 *             if the reader could not be created
	 * 
	 * @return a newly created reader
	 */</jtok>
<jtok eid="8" type="class_or_interface_ref" span="115:12:115:18">Reader</jtok>
<jtok eid="8" type="method_name" span="115:19:115:28">getReader</jtok>
<jtok eid="8" type="parameter_type" span="115:29:115:35">String</jtok>
<jtok eid="8" type="parameter_name" span="115:36:115:44">filename</jtok>
<jtok eid="8" type="throws" span="115:53:115:64">IOException</jtok>
<jtok eid="8" type="line_comment" span="116:3:116:63">// If this is a custom export, just use the given file name:</jtok>
<jtok eid="8" type="class_or_interface_ref" span="117:3:117:9">String</jtok>
<jtok eid="8" type="local_variable_name" span="117:10:117:13">dir</jtok>
<jtok eid="8" type="primary_name_ref" span="118:7:118:19">customExport</jtok>
<jtok eid="8" type="primary_name_ref" span="119:4:119:7">dir</jtok>
<jtok eid="8" type="string_literal" span="119:10:119:12">""</jtok>
<jtok eid="8" type="primary_name_ref" span="121:4:121:7">dir</jtok>
<jtok eid="8" type="primary_name_ref" span="121:10:121:17">Globals</jtok>
<jtok eid="8" type="qualified_name_ref" span="121:18:121:31">LAYOUT_PREFIX</jtok>
<jtok eid="8" type="primary_name_ref" span="122:8:122:17">directory</jtok>
<jtok eid="8" type="string_literal" span="122:28:122:30">""</jtok>
<jtok eid="8" type="primary_name_ref" span="122:33:122:42">directory</jtok>
<jtok eid="8" type="string_literal" span="122:45:122:48">"/"</jtok>
<jtok eid="8" type="primary_name_ref" span="124:10:124:21">FileActions</jtok>
<jtok eid="8" type="method_call" span="124:22:124:31">getReader</jtok>
<jtok eid="8" type="primary_name_ref" span="124:32:124:35">dir</jtok>
<jtok eid="8" type="primary_name_ref" span="124:38:124:46">filename</jtok>
<jtok eid="1" type="block_comment" span="127:2:150:5">/**
	 * Perform the export of {@code database}.
	 * 
	 * @param database
	 *            The database to export from.
     * @param metaData
     *            The database's meta data.
	 * @param file
	 *            the file to write the resulting export to
	 * @param encoding
	 *            The encoding of the database
	 * @param entryIds
	 *            Contains the IDs of all entries that should be exported. If
	 *            &lt;code&gt;null&lt;/code&gt;, all entries will be exported.
	 * 
	 * @throws IOException
	 *             if a problem occurred while trying to write to {@code writer}
	 *             or read from required resources.
	 * @throws Exception
	 *             if any other error occurred during export.
	 * 
	 * @see net.sf.jabref.export.IExportFormat#performExport(net.sf.jabref.BibtexDatabase,
	 *      net.sf.jabref.MetaData, java.lang.String, java.lang.String, java.util.Set)
	 */</jtok>
<jtok eid="9" type="method_name" span="151:14:151:27">performExport</jtok>
<jtok eid="9" type="parameter_type" span="151:34:151:48">BibtexDatabase</jtok>
<jtok eid="9" type="parameter_name" span="151:49:151:57">database</jtok>
<jtok eid="9" type="parameter_type" span="152:19:152:27">MetaData</jtok>
<jtok eid="9" type="parameter_name" span="152:28:152:36">metaData</jtok>
<jtok eid="9" type="parameter_type" span="152:44:152:50">String</jtok>
<jtok eid="9" type="parameter_name" span="152:51:152:55">file</jtok>
<jtok eid="9" type="parameter_type" span="153:9:153:15">String</jtok>
<jtok eid="9" type="parameter_name" span="153:16:153:24">encoding</jtok>
<jtok eid="9" type="parameter_type" span="153:26:153:29">Set</jtok>
<jtok eid="9" type="parameter_type" span="153:30:153:36">String</jtok>
<jtok eid="9" type="parameter_name" span="153:38:153:46">entryIds</jtok>
<jtok eid="9" type="throws" span="153:55:153:64">Exception</jtok>
<jtok eid="9" type="class_or_interface_ref" span="155:9:155:13">File</jtok>
<jtok eid="9" type="local_variable_name" span="155:14:155:21">outFile</jtok>
<jtok eid="9" type="constructor_call" span="155:28:155:32">File</jtok>
<jtok eid="9" type="primary_name_ref" span="155:33:155:37">file</jtok>
<jtok eid="9" type="class_or_interface_ref" span="156:9:156:20">SaveSession</jtok>
<jtok eid="9" type="local_variable_name" span="156:21:156:23">ss</jtok>
<jtok eid="9" type="qualified_name_ref" span="157:18:157:26">encoding</jtok>
<jtok eid="9" type="primary_name_ref" span="159:17:159:19">ss</jtok>
<jtok eid="9" type="method_call" span="159:22:159:36">getSaveSession</jtok>
<jtok eid="9" type="qualified_name_ref" span="159:42:159:50">encoding</jtok>
<jtok eid="9" type="primary_name_ref" span="159:52:159:59">outFile</jtok>
<jtok eid="9" type="class_or_interface_ref" span="160:22:160:33">IOException</jtok>
<jtok eid="9" type="local_variable_name" span="160:34:160:36">ex</jtok>
<jtok eid="9" type="line_comment" span="161:17:161:65">// Perhaps the overriding encoding doesn't work?</jtok>
<jtok eid="9" type="line_comment" span="162:17:162:62">// We will fall back on the default encoding.</jtok>
<jtok eid="9" type="primary_name_ref" span="163:17:163:19">ex</jtok>
<jtok eid="9" type="method_call" span="163:20:163:35">printStackTrace</jtok>
<jtok eid="9" type="primary_name_ref" span="167:7:167:9">ss</jtok>
<jtok eid="9" type="primary_name_ref" span="168:7:168:9">ss</jtok>
<jtok eid="9" type="method_call" span="168:12:168:26">getSaveSession</jtok>
<jtok eid="9" type="primary_name_ref" span="168:27:168:35">encoding</jtok>
<jtok eid="9" type="primary_name_ref" span="168:37:168:44">outFile</jtok>
<jtok eid="9" type="class_or_interface_ref" span="170:3:170:18">VerifyingWriter</jtok>
<jtok eid="9" type="local_variable_name" span="170:19:170:21">ps</jtok>
<jtok eid="9" type="primary_name_ref" span="170:24:170:26">ss</jtok>
<jtok eid="9" type="method_call" span="170:27:170:36">getWriter</jtok>
<jtok eid="9" type="class_or_interface_ref" span="172:9:172:15">Layout</jtok>
<jtok eid="9" type="local_variable_name" span="172:16:172:27">beginLayout</jtok>
<jtok eid="9" type="class_or_interface_ref" span="173:3:173:9">Reader</jtok>
<jtok eid="9" type="local_variable_name" span="173:10:173:16">reader</jtok>
<jtok eid="9" type="line_comment" span="175:9:175:68">// Check if this export filter has bundled name formatters:</jtok>
<jtok eid="9" type="class_or_interface_ref" span="176:9:176:16">HashMap</jtok>
<jtok eid="9" type="class_or_interface_ref" span="176:17:176:23">String</jtok>
<jtok eid="9" type="class_or_interface_ref" span="176:24:176:30">String</jtok>
<jtok eid="9" type="local_variable_name" span="176:32:176:52">customNameFormatters</jtok>
<jtok eid="9" type="method_call" span="176:55:176:72">readFormatterFile</jtok>
<jtok eid="9" type="primary_name_ref" span="176:73:176:83">lfFileName</jtok>
<jtok eid="9" type="line_comment" span="177:9:177:89">// Set a global field, so all layouts have access to the custom name formatters:</jtok>
<jtok eid="9" type="primary_name_ref" span="178:9:178:16">Globals</jtok>
<jtok eid="9" type="qualified_name_ref" span="178:17:178:22">prefs</jtok>
<jtok eid="9" type="qualified_name_ref" span="178:23:178:49">customExportNameFormatters</jtok>
<jtok eid="9" type="primary_name_ref" span="178:52:178:72">customNameFormatters</jtok>
<jtok eid="9" type="class_or_interface_ref" span="180:9:180:18">ArrayList</jtok>
<jtok eid="9" type="class_or_interface_ref" span="180:19:180:25">String</jtok>
<jtok eid="9" type="local_variable_name" span="180:27:180:44">missingFormatters</jtok>
<jtok eid="9" type="constructor_call" span="180:51:180:60">ArrayList</jtok>
<jtok eid="9" type="constructor_call" span="180:61:180:67">String</jtok>
<jtok eid="9" type="line_comment" span="182:9:182:24">// Print header</jtok>
<jtok eid="9" type="primary_name_ref" span="184:4:184:10">reader</jtok>
<jtok eid="9" type="method_call" span="184:13:184:22">getReader</jtok>
<jtok eid="9" type="primary_name_ref" span="184:23:184:33">lfFileName</jtok>
<jtok eid="9" type="string_literal" span="184:36:184:51">".begin.layout"</jtok>
<jtok eid="9" type="class_or_interface_ref" span="185:4:185:16">LayoutHelper</jtok>
<jtok eid="9" type="local_variable_name" span="185:17:185:29">layoutHelper</jtok>
<jtok eid="9" type="constructor_call" span="185:36:185:48">LayoutHelper</jtok>
<jtok eid="9" type="primary_name_ref" span="185:49:185:55">reader</jtok>
<jtok eid="9" type="primary_name_ref" span="186:4:186:15">beginLayout</jtok>
<jtok eid="9" type="primary_name_ref" span="186:18:186:30">layoutHelper</jtok>
<jtok eid="9" type="method_call" span="187:6:187:23">getLayoutFromText</jtok>
<jtok eid="9" type="primary_name_ref" span="187:24:187:31">Globals</jtok>
<jtok eid="9" type="qualified_name_ref" span="187:32:187:49">FORMATTER_PACKAGE</jtok>
<jtok eid="9" type="primary_name_ref" span="188:13:188:19">reader</jtok>
<jtok eid="9" type="method_call" span="188:20:188:25">close</jtok>
<jtok eid="9" type="class_or_interface_ref" span="189:12:189:23">IOException</jtok>
<jtok eid="9" type="local_variable_name" span="189:24:189:26">ex</jtok>
<jtok eid="9" type="line_comment" span="190:4:190:67">// If an exception was cast, export filter doesn't have a begin</jtok>
<jtok eid="9" type="line_comment" span="191:4:191:12">// file.</jtok>
<jtok eid="9" type="line_comment" span="193:3:193:22">// Write the header</jtok>
<jtok eid="9" type="primary_name_ref" span="194:7:194:18">beginLayout</jtok>
<jtok eid="9" type="primary_name_ref" span="195:4:195:6">ps</jtok>
<jtok eid="9" type="method_call" span="195:7:195:12">write</jtok>
<jtok eid="9" type="primary_name_ref" span="195:13:195:24">beginLayout</jtok>
<jtok eid="9" type="method_call" span="195:25:195:33">doLayout</jtok>
<jtok eid="9" type="primary_name_ref" span="195:34:195:42">database</jtok>
<jtok eid="9" type="primary_name_ref" span="195:44:195:52">encoding</jtok>
<jtok eid="9" type="primary_name_ref" span="196:13:196:30">missingFormatters</jtok>
<jtok eid="9" type="method_call" span="196:31:196:37">addAll</jtok>
<jtok eid="9" type="primary_name_ref" span="196:38:196:49">beginLayout</jtok>
<jtok eid="9" type="method_call" span="196:50:196:70">getMissingFormatters</jtok>
<jtok eid="9" type="block_comment" span="199:3:205:6">/*
		 * Write database entries; entries will be sorted as they appear on the
		 * screen, or sorted by author, depending on Preferences. We also supply
		 * the Set entries - if we are to export only certain entries, it will
		 * be non-null, and be used to choose entries. Otherwise, it will be
		 * null, and be ignored.
		 */</jtok>
<jtok eid="9" type="class_or_interface_ref" span="206:3:206:7">List</jtok>
<jtok eid="9" type="class_or_interface_ref" span="206:8:206:19">BibtexEntry</jtok>
<jtok eid="9" type="local_variable_name" span="206:21:206:27">sorted</jtok>
<jtok eid="9" type="primary_name_ref" span="206:30:206:41">FileActions</jtok>
<jtok eid="9" type="method_call" span="206:42:206:58">getSortedEntries</jtok>
<jtok eid="9" type="primary_name_ref" span="206:59:206:67">database</jtok>
<jtok eid="9" type="primary_name_ref" span="207:4:207:12">entryIds</jtok>
<jtok eid="9" type="line_comment" span="209:3:209:25">// Load default layout</jtok>
<jtok eid="9" type="primary_name_ref" span="210:3:210:9">reader</jtok>
<jtok eid="9" type="method_call" span="210:12:210:21">getReader</jtok>
<jtok eid="9" type="primary_name_ref" span="210:22:210:32">lfFileName</jtok>
<jtok eid="9" type="string_literal" span="210:35:210:44">".layout"</jtok>
<jtok eid="9" type="class_or_interface_ref" span="212:3:212:15">LayoutHelper</jtok>
<jtok eid="9" type="local_variable_name" span="212:16:212:28">layoutHelper</jtok>
<jtok eid="9" type="constructor_call" span="212:35:212:47">LayoutHelper</jtok>
<jtok eid="9" type="primary_name_ref" span="212:48:212:54">reader</jtok>
<jtok eid="9" type="class_or_interface_ref" span="213:3:213:9">Layout</jtok>
<jtok eid="9" type="local_variable_name" span="213:10:213:19">defLayout</jtok>
<jtok eid="9" type="primary_name_ref" span="213:22:213:34">layoutHelper</jtok>
<jtok eid="9" type="method_call" span="214:5:214:22">getLayoutFromText</jtok>
<jtok eid="9" type="primary_name_ref" span="214:23:214:30">Globals</jtok>
<jtok eid="9" type="qualified_name_ref" span="214:31:214:48">FORMATTER_PACKAGE</jtok>
<jtok eid="9" type="primary_name_ref" span="215:3:215:9">reader</jtok>
<jtok eid="9" type="method_call" span="215:10:215:15">close</jtok>
<jtok eid="9" type="primary_name_ref" span="216:13:216:22">defLayout</jtok>
<jtok eid="9" type="primary_name_ref" span="217:13:217:30">missingFormatters</jtok>
<jtok eid="9" type="method_call" span="217:31:217:37">addAll</jtok>
<jtok eid="9" type="primary_name_ref" span="217:38:217:47">defLayout</jtok>
<jtok eid="9" type="method_call" span="217:48:217:68">getMissingFormatters</jtok>
<jtok eid="9" type="primary_name_ref" span="218:13:218:19">System</jtok>
<jtok eid="9" type="qualified_name_ref" span="218:20:218:23">out</jtok>
<jtok eid="9" type="method_call" span="218:24:218:31">println</jtok>
<jtok eid="9" type="primary_name_ref" span="218:32:218:41">defLayout</jtok>
<jtok eid="9" type="method_call" span="218:42:218:62">getMissingFormatters</jtok>
<jtok eid="9" type="class_or_interface_ref" span="220:3:220:10">HashMap</jtok>
<jtok eid="9" type="class_or_interface_ref" span="220:11:220:17">String</jtok>
<jtok eid="9" type="class_or_interface_ref" span="220:19:220:25">Layout</jtok>
<jtok eid="9" type="local_variable_name" span="220:27:220:34">layouts</jtok>
<jtok eid="9" type="constructor_call" span="220:41:220:48">HashMap</jtok>
<jtok eid="9" type="constructor_call" span="220:49:220:55">String</jtok>
<jtok eid="9" type="constructor_call" span="220:57:220:63">Layout</jtok>
<jtok eid="9" type="class_or_interface_ref" span="221:3:221:9">Layout</jtok>
<jtok eid="9" type="local_variable_name" span="221:10:221:16">layout</jtok>
<jtok eid="9" type="primary_name_ref" span="223:9:223:22">ExportFormats</jtok>
<jtok eid="9" type="qualified_name_ref" span="223:23:223:34">entryNumber</jtok>
<jtok eid="9" type="class_or_interface_ref" span="224:8:224:19">BibtexEntry</jtok>
<jtok eid="9" type="local_variable_name" span="224:20:224:25">entry</jtok>
<jtok eid="9" type="primary_name_ref" span="224:28:224:34">sorted</jtok>
<jtok eid="9" type="primary_name_ref" span="225:13:225:26">ExportFormats</jtok>
<jtok eid="9" type="qualified_name_ref" span="225:27:225:38">entryNumber</jtok>
<jtok eid="9" type="line_comment" span="225:42:225:69">// Increment entry counter.</jtok>
<jtok eid="9" type="line_comment" span="226:4:226:21">// Get the layout</jtok>
<jtok eid="9" type="class_or_interface_ref" span="227:4:227:10">String</jtok>
<jtok eid="9" type="local_variable_name" span="227:11:227:15">type</jtok>
<jtok eid="9" type="primary_name_ref" span="227:18:227:23">entry</jtok>
<jtok eid="9" type="method_call" span="227:24:227:31">getType</jtok>
<jtok eid="9" type="method_call" span="227:34:227:41">getName</jtok>
<jtok eid="9" type="method_call" span="227:44:227:55">toLowerCase</jtok>
<jtok eid="9" type="primary_name_ref" span="228:8:228:15">layouts</jtok>
<jtok eid="9" type="method_call" span="228:16:228:27">containsKey</jtok>
<jtok eid="9" type="primary_name_ref" span="228:28:228:32">type</jtok>
<jtok eid="9" type="primary_name_ref" span="229:5:229:11">layout</jtok>
<jtok eid="9" type="primary_name_ref" span="229:14:229:21">layouts</jtok>
<jtok eid="9" type="method_call" span="229:22:229:25">get</jtok>
<jtok eid="9" type="primary_name_ref" span="229:26:229:30">type</jtok>
<jtok eid="9" type="line_comment" span="232:6:232:61">// We try to get a type-specific layout for this entry.</jtok>
<jtok eid="9" type="primary_name_ref" span="233:6:233:12">reader</jtok>
<jtok eid="9" type="method_call" span="233:15:233:24">getReader</jtok>
<jtok eid="9" type="primary_name_ref" span="233:25:233:35">lfFileName</jtok>
<jtok eid="9" type="string_literal" span="233:38:233:41">"."</jtok>
<jtok eid="9" type="primary_name_ref" span="233:44:233:48">type</jtok>
<jtok eid="9" type="string_literal" span="233:51:233:60">".layout"</jtok>
<jtok eid="9" type="primary_name_ref" span="234:6:234:18">layoutHelper</jtok>
<jtok eid="9" type="constructor_call" span="234:25:234:37">LayoutHelper</jtok>
<jtok eid="9" type="primary_name_ref" span="234:38:234:44">reader</jtok>
<jtok eid="9" type="primary_name_ref" span="235:6:235:12">layout</jtok>
<jtok eid="9" type="primary_name_ref" span="235:15:235:27">layoutHelper</jtok>
<jtok eid="9" type="method_call" span="236:8:236:25">getLayoutFromText</jtok>
<jtok eid="9" type="primary_name_ref" span="236:26:236:33">Globals</jtok>
<jtok eid="9" type="qualified_name_ref" span="236:34:236:51">FORMATTER_PACKAGE</jtok>
<jtok eid="9" type="primary_name_ref" span="237:6:237:13">layouts</jtok>
<jtok eid="9" type="method_call" span="237:14:237:17">put</jtok>
<jtok eid="9" type="primary_name_ref" span="237:18:237:22">type</jtok>
<jtok eid="9" type="primary_name_ref" span="237:24:237:30">layout</jtok>
<jtok eid="9" type="primary_name_ref" span="238:6:238:12">reader</jtok>
<jtok eid="9" type="method_call" span="238:13:238:18">close</jtok>
<jtok eid="9" type="primary_name_ref" span="239:25:239:31">layout</jtok>
<jtok eid="9" type="primary_name_ref" span="240:25:240:42">missingFormatters</jtok>
<jtok eid="9" type="method_call" span="240:43:240:49">addAll</jtok>
<jtok eid="9" type="primary_name_ref" span="240:50:240:56">layout</jtok>
<jtok eid="9" type="method_call" span="240:57:240:77">getMissingFormatters</jtok>
<jtok eid="9" type="class_or_interface_ref" span="242:14:242:25">IOException</jtok>
<jtok eid="9" type="local_variable_name" span="242:26:242:28">ex</jtok>
<jtok eid="9" type="line_comment" span="243:6:243:61">// The exception indicates that no type-specific layout</jtok>
<jtok eid="9" type="line_comment" span="244:6:244:22">// exists, so we</jtok>
<jtok eid="9" type="line_comment" span="245:6:245:33">// go with the default one.</jtok>
<jtok eid="9" type="primary_name_ref" span="246:6:246:12">layout</jtok>
<jtok eid="9" type="primary_name_ref" span="246:15:246:24">defLayout</jtok>
<jtok eid="9" type="line_comment" span="250:4:250:22">// Write the entry</jtok>
<jtok eid="9" type="primary_name_ref" span="251:4:251:6">ps</jtok>
<jtok eid="9" type="method_call" span="251:7:251:12">write</jtok>
<jtok eid="9" type="primary_name_ref" span="251:13:251:19">layout</jtok>
<jtok eid="9" type="method_call" span="251:20:251:28">doLayout</jtok>
<jtok eid="9" type="primary_name_ref" span="251:29:251:34">entry</jtok>
<jtok eid="9" type="primary_name_ref" span="251:36:251:44">database</jtok>
<jtok eid="9" type="line_comment" span="254:3:254:18">// Print footer</jtok>
<jtok eid="9" type="line_comment" span="256:3:256:39">// changed section - begin (arudert)</jtok>
<jtok eid="9" type="class_or_interface_ref" span="257:3:257:9">Layout</jtok>
<jtok eid="9" type="local_variable_name" span="257:10:257:19">endLayout</jtok>
<jtok eid="9" type="primary_name_ref" span="259:4:259:10">reader</jtok>
<jtok eid="9" type="method_call" span="259:13:259:22">getReader</jtok>
<jtok eid="9" type="primary_name_ref" span="259:23:259:33">lfFileName</jtok>
<jtok eid="9" type="string_literal" span="259:36:259:49">".end.layout"</jtok>
<jtok eid="9" type="primary_name_ref" span="260:4:260:16">layoutHelper</jtok>
<jtok eid="9" type="constructor_call" span="260:23:260:35">LayoutHelper</jtok>
<jtok eid="9" type="primary_name_ref" span="260:36:260:42">reader</jtok>
<jtok eid="9" type="primary_name_ref" span="261:4:261:13">endLayout</jtok>
<jtok eid="9" type="primary_name_ref" span="261:16:261:28">layoutHelper</jtok>
<jtok eid="9" type="method_call" span="262:6:262:23">getLayoutFromText</jtok>
<jtok eid="9" type="primary_name_ref" span="262:24:262:31">Globals</jtok>
<jtok eid="9" type="qualified_name_ref" span="262:32:262:49">FORMATTER_PACKAGE</jtok>
<jtok eid="9" type="primary_name_ref" span="263:4:263:10">reader</jtok>
<jtok eid="9" type="method_call" span="263:11:263:16">close</jtok>
<jtok eid="9" type="class_or_interface_ref" span="264:12:264:23">IOException</jtok>
<jtok eid="9" type="local_variable_name" span="264:24:264:26">ex</jtok>
<jtok eid="9" type="line_comment" span="265:4:265:68">// If an exception was thrown, export filter doesn't have an end</jtok>
<jtok eid="9" type="line_comment" span="266:4:266:12">// file.</jtok>
<jtok eid="9" type="line_comment" span="269:3:269:18">// Write footer</jtok>
<jtok eid="9" type="primary_name_ref" span="270:7:270:16">endLayout</jtok>
<jtok eid="9" type="primary_name_ref" span="271:4:271:6">ps</jtok>
<jtok eid="9" type="method_call" span="271:7:271:12">write</jtok>
<jtok eid="9" type="primary_name_ref" span="271:13:271:22">endLayout</jtok>
<jtok eid="9" type="method_call" span="271:23:271:31">doLayout</jtok>
<jtok eid="9" type="primary_name_ref" span="271:32:271:40">database</jtok>
<jtok eid="9" type="primary_name_ref" span="271:42:271:50">encoding</jtok>
<jtok eid="9" type="primary_name_ref" span="272:13:272:30">missingFormatters</jtok>
<jtok eid="9" type="method_call" span="272:31:272:37">addAll</jtok>
<jtok eid="9" type="primary_name_ref" span="272:38:272:47">endLayout</jtok>
<jtok eid="9" type="method_call" span="272:48:272:68">getMissingFormatters</jtok>
<jtok eid="9" type="line_comment" span="275:9:275:41">// Clear custom name formatters:</jtok>
<jtok eid="9" type="primary_name_ref" span="276:9:276:16">Globals</jtok>
<jtok eid="9" type="qualified_name_ref" span="276:17:276:22">prefs</jtok>
<jtok eid="9" type="qualified_name_ref" span="276:23:276:49">customExportNameFormatters</jtok>
<jtok eid="9" type="primary_name_ref" span="278:13:278:30">missingFormatters</jtok>
<jtok eid="9" type="method_call" span="278:31:278:35">size</jtok>
<jtok eid="9" type="class_or_interface_ref" span="279:13:279:26">StringBuilder</jtok>
<jtok eid="9" type="local_variable_name" span="279:27:279:29">sb</jtok>
<jtok eid="9" type="constructor_call" span="279:36:279:49">StringBuilder</jtok>
<jtok eid="9" type="string_literal" span="279:50:279:95">"The following formatters could not be found"</jtok>
<jtok eid="9" type="method_call" span="280:21:280:27">append</jtok>
<jtok eid="9" type="string_literal" span="280:28:280:32">": "</jtok>
<jtok eid="9" type="class_or_interface_ref" span="281:18:281:26">Iterator</jtok>
<jtok eid="9" type="class_or_interface_ref" span="281:27:281:33">String</jtok>
<jtok eid="9" type="local_variable_name" span="281:35:281:36">i</jtok>
<jtok eid="9" type="primary_name_ref" span="281:39:281:56">missingFormatters</jtok>
<jtok eid="9" type="method_call" span="281:57:281:65">iterator</jtok>
<jtok eid="9" type="primary_name_ref" span="281:69:281:70">i</jtok>
<jtok eid="9" type="method_call" span="281:71:281:78">hasNext</jtok>
<jtok eid="9" type="primary_name_ref" span="282:17:282:19">sb</jtok>
<jtok eid="9" type="method_call" span="282:20:282:26">append</jtok>
<jtok eid="9" type="primary_name_ref" span="282:27:282:28">i</jtok>
<jtok eid="9" type="method_call" span="282:29:282:33">next</jtok>
<jtok eid="9" type="primary_name_ref" span="283:21:283:22">i</jtok>
<jtok eid="9" type="method_call" span="283:23:283:30">hasNext</jtok>
<jtok eid="9" type="primary_name_ref" span="284:21:284:23">sb</jtok>
<jtok eid="9" type="method_call" span="284:24:284:30">append</jtok>
<jtok eid="9" type="string_literal" span="284:31:284:35">", "</jtok>
<jtok eid="9" type="primary_name_ref" span="286:13:286:19">System</jtok>
<jtok eid="9" type="qualified_name_ref" span="286:20:286:23">err</jtok>
<jtok eid="9" type="method_call" span="286:24:286:31">println</jtok>
<jtok eid="9" type="primary_name_ref" span="286:32:286:34">sb</jtok>
<jtok eid="9" type="method_call" span="286:35:286:43">toString</jtok>
<jtok eid="9" type="method_call" span="289:9:289:28">finalizeSaveSession</jtok>
<jtok eid="9" type="primary_name_ref" span="289:29:289:31">ss</jtok>
<jtok eid="1" type="block_comment" span="292:5:296:8">/**
     * See if there is a name formatter file bundled with this export format. If so, read
     * all the name formatters so they can be used by the filter layouts.
     * @param lfFileName The layout file name.
     */</jtok>
<jtok eid="10" type="class_or_interface_ref" span="297:13:297:20">HashMap</jtok>
<jtok eid="10" type="class_or_interface_ref" span="297:21:297:27">String</jtok>
<jtok eid="10" type="class_or_interface_ref" span="297:29:297:35">String</jtok>
<jtok eid="10" type="method_name" span="297:37:297:54">readFormatterFile</jtok>
<jtok eid="10" type="parameter_type" span="297:55:297:61">String</jtok>
<jtok eid="10" type="parameter_name" span="297:62:297:72">lfFileName</jtok>
<jtok eid="10" type="class_or_interface_ref" span="298:9:298:16">HashMap</jtok>
<jtok eid="10" type="class_or_interface_ref" span="298:17:298:23">String</jtok>
<jtok eid="10" type="class_or_interface_ref" span="298:24:298:30">String</jtok>
<jtok eid="10" type="local_variable_name" span="298:32:298:42">formatters</jtok>
<jtok eid="10" type="constructor_call" span="298:49:298:56">HashMap</jtok>
<jtok eid="10" type="constructor_call" span="298:57:298:63">String</jtok>
<jtok eid="10" type="constructor_call" span="298:65:298:71">String</jtok>
<jtok eid="10" type="class_or_interface_ref" span="299:9:299:13">File</jtok>
<jtok eid="10" type="local_variable_name" span="299:14:299:27">formatterFile</jtok>
<jtok eid="10" type="constructor_call" span="299:34:299:38">File</jtok>
<jtok eid="10" type="primary_name_ref" span="299:39:299:49">lfFileName</jtok>
<jtok eid="10" type="string_literal" span="299:52:299:65">".formatters"</jtok>
<jtok eid="10" type="primary_name_ref" span="300:13:300:26">formatterFile</jtok>
<jtok eid="10" type="method_call" span="300:27:300:33">exists</jtok>
<jtok eid="10" type="class_or_interface_ref" span="301:13:301:19">Reader</jtok>
<jtok eid="10" type="local_variable_name" span="301:20:301:22">in</jtok>
<jtok eid="10" type="primary_name_ref" span="303:17:303:19">in</jtok>
<jtok eid="10" type="constructor_call" span="303:26:303:36">FileReader</jtok>
<jtok eid="10" type="primary_name_ref" span="303:37:303:50">formatterFile</jtok>
<jtok eid="10" type="primary_name_ref" span="304:21:304:23">in</jtok>
<jtok eid="10" type="line_comment" span="305:21:305:76">// Ok, we found and opened the file. Read all contents:</jtok>
<jtok eid="10" type="class_or_interface_ref" span="306:21:306:34">StringBuilder</jtok>
<jtok eid="10" type="local_variable_name" span="306:35:306:37">sb</jtok>
<jtok eid="10" type="constructor_call" span="306:44:306:57">StringBuilder</jtok>
<jtok eid="10" type="local_variable_name" span="307:25:307:26">c</jtok>
<jtok eid="10" type="primary_name_ref" span="308:29:308:30">c</jtok>
<jtok eid="10" type="primary_name_ref" span="308:33:308:35">in</jtok>
<jtok eid="10" type="method_call" span="308:36:308:40">read</jtok>
<jtok eid="10" type="primary_name_ref" span="309:25:309:27">sb</jtok>
<jtok eid="10" type="method_call" span="309:28:309:34">append</jtok>
<jtok eid="10" type="primary_name_ref" span="309:41:309:42">c</jtok>
<jtok eid="10" type="class_or_interface_ref" span="311:21:311:27">String</jtok>
<jtok eid="10" type="local_variable_name" span="311:30:311:35">lines</jtok>
<jtok eid="10" type="primary_name_ref" span="311:38:311:40">sb</jtok>
<jtok eid="10" type="method_call" span="311:41:311:49">toString</jtok>
<jtok eid="10" type="method_call" span="311:52:311:57">split</jtok>
<jtok eid="10" type="string_literal" span="311:58:311:62">"\n"</jtok>
<jtok eid="10" type="line_comment" span="312:21:312:45">// Go through each line:</jtok>
<jtok eid="10" type="local_variable_name" span="313:30:313:31">i</jtok>
<jtok eid="10" type="primary_name_ref" span="313:35:313:36">i</jtok>
<jtok eid="10" type="primary_name_ref" span="313:37:313:42">lines</jtok>
<jtok eid="10" type="qualified_name_ref" span="313:43:313:49">length</jtok>
<jtok eid="10" type="primary_name_ref" span="313:51:313:52">i</jtok>
<jtok eid="10" type="class_or_interface_ref" span="314:25:314:31">String</jtok>
<jtok eid="10" type="local_variable_name" span="314:32:314:36">line</jtok>
<jtok eid="10" type="primary_name_ref" span="314:39:314:44">lines</jtok>
<jtok eid="10" type="primary_name_ref" span="314:45:314:46">i</jtok>
<jtok eid="10" type="method_call" span="314:48:314:52">trim</jtok>
<jtok eid="10" type="line_comment" span="315:25:315:57">// Do not deal with empty lines:</jtok>
<jtok eid="10" type="primary_name_ref" span="316:29:316:33">line</jtok>
<jtok eid="10" type="method_call" span="316:34:316:40">length</jtok>
<jtok eid="10" type="local_variable_name" span="318:29:318:34">index</jtok>
<jtok eid="10" type="primary_name_ref" span="318:37:318:41">line</jtok>
<jtok eid="10" type="method_call" span="318:42:318:49">indexOf</jtok>
<jtok eid="10" type="string_literal" span="318:50:318:53">":"</jtok>
<jtok eid="10" type="line_comment" span="318:56:318:104">// TODO: any need to accept escaped colons here?</jtok>
<jtok eid="10" type="primary_name_ref" span="319:30:319:35">index</jtok>
<jtok eid="10" type="primary_name_ref" span="319:45:319:50">index</jtok>
<jtok eid="10" type="primary_name_ref" span="319:55:319:59">line</jtok>
<jtok eid="10" type="method_call" span="319:60:319:66">length</jtok>
<jtok eid="10" type="class_or_interface_ref" span="320:29:320:35">String</jtok>
<jtok eid="10" type="local_variable_name" span="320:36:320:49">formatterName</jtok>
<jtok eid="10" type="primary_name_ref" span="320:52:320:56">line</jtok>
<jtok eid="10" type="method_call" span="320:57:320:66">substring</jtok>
<jtok eid="10" type="primary_name_ref" span="320:70:320:75">index</jtok>
<jtok eid="10" type="class_or_interface_ref" span="321:29:321:35">String</jtok>
<jtok eid="10" type="local_variable_name" span="321:36:321:44">contents</jtok>
<jtok eid="10" type="primary_name_ref" span="321:47:321:51">line</jtok>
<jtok eid="10" type="method_call" span="321:52:321:61">substring</jtok>
<jtok eid="10" type="primary_name_ref" span="321:62:321:67">index</jtok>
<jtok eid="10" type="line_comment" span="322:29:322:79">//System.out.println("Name: '"+formatterName+"'");</jtok>
<jtok eid="10" type="line_comment" span="323:29:323:78">//System.out.println("Contents: '"+contents+"'");</jtok>
<jtok eid="10" type="primary_name_ref" span="324:29:324:39">formatters</jtok>
<jtok eid="10" type="method_call" span="324:40:324:43">put</jtok>
<jtok eid="10" type="primary_name_ref" span="324:44:324:57">formatterName</jtok>
<jtok eid="10" type="primary_name_ref" span="324:59:324:67">contents</jtok>
<jtok eid="10" type="class_or_interface_ref" span="329:22:329:33">IOException</jtok>
<jtok eid="10" type="local_variable_name" span="329:34:329:36">ex</jtok>
<jtok eid="10" type="line_comment" span="330:17:330:50">// TODO: show error message here?</jtok>
<jtok eid="10" type="primary_name_ref" span="331:17:331:19">ex</jtok>
<jtok eid="10" type="method_call" span="331:20:331:35">printStackTrace</jtok>
<jtok eid="10" type="primary_name_ref" span="333:21:333:23">in</jtok>
<jtok eid="10" type="primary_name_ref" span="335:25:335:27">in</jtok>
<jtok eid="10" type="method_call" span="335:28:335:33">close</jtok>
<jtok eid="10" type="class_or_interface_ref" span="336:30:336:41">IOException</jtok>
<jtok eid="10" type="local_variable_name" span="336:42:336:44">ex</jtok>
<jtok eid="10" type="primary_name_ref" span="337:25:337:27">ex</jtok>
<jtok eid="10" type="method_call" span="337:28:337:43">printStackTrace</jtok>
<jtok eid="10" type="primary_name_ref" span="341:16:341:26">formatters</jtok>
<jtok eid="11" type="class_or_interface_ref" span="344:15:344:26">SaveSession</jtok>
<jtok eid="11" type="method_name" span="344:27:344:41">getSaveSession</jtok>
<jtok eid="11" type="parameter_type" span="344:48:344:54">String</jtok>
<jtok eid="11" type="parameter_name" span="344:55:344:63">encoding</jtok>
<jtok eid="11" type="parameter_type" span="345:9:345:13">File</jtok>
<jtok eid="11" type="parameter_name" span="345:14:345:21">outFile</jtok>
<jtok eid="11" type="throws" span="345:30:345:41">IOException</jtok>
<jtok eid="11" type="constructor_call" span="346:14:346:25">SaveSession</jtok>
<jtok eid="11" type="primary_name_ref" span="346:26:346:33">outFile</jtok>
<jtok eid="11" type="primary_name_ref" span="346:35:346:43">encoding</jtok>
<jtok eid="1" type="block_comment" span="349:2:351:5">/**
	 * @see net.sf.jabref.export.IExportFormat#getFileFilter()
	 */</jtok>
<jtok eid="12" type="class_or_interface_ref" span="352:9:352:19">FileFilter</jtok>
<jtok eid="12" type="method_name" span="352:20:352:33">getFileFilter</jtok>
<jtok eid="12" type="primary_name_ref" span="353:7:353:17">fileFilter</jtok>
<jtok eid="12" type="primary_name_ref" span="354:4:354:14">fileFilter</jtok>
<jtok eid="12" type="constructor_call" span="354:21:354:37">ExportFileFilter</jtok>
<jtok eid="12" type="primary_name_ref" span="354:44:354:53">extension</jtok>
<jtok eid="12" type="primary_name_ref" span="355:10:355:20">fileFilter</jtok>
<jtok eid="13" type="method_name" span="358:14:358:33">finalizeSaveSession</jtok>
<jtok eid="13" type="parameter_type" span="358:40:358:51">SaveSession</jtok>
<jtok eid="13" type="parameter_name" span="358:52:358:54">ss</jtok>
<jtok eid="13" type="throws" span="358:63:358:72">Exception</jtok>
<jtok eid="13" type="primary_name_ref" span="359:3:359:5">ss</jtok>
<jtok eid="13" type="method_call" span="359:6:359:15">getWriter</jtok>
<jtok eid="13" type="method_call" span="359:18:359:23">flush</jtok>
<jtok eid="13" type="primary_name_ref" span="360:3:360:5">ss</jtok>
<jtok eid="13" type="method_call" span="360:6:360:15">getWriter</jtok>
<jtok eid="13" type="method_call" span="360:18:360:23">close</jtok>
<jtok eid="13" type="primary_name_ref" span="362:8:362:10">ss</jtok>
<jtok eid="13" type="method_call" span="362:11:362:20">getWriter</jtok>
<jtok eid="13" type="method_call" span="362:23:362:37">couldEncodeAll</jtok>
<jtok eid="13" type="primary_name_ref" span="363:4:363:10">System</jtok>
<jtok eid="13" type="qualified_name_ref" span="363:11:363:14">err</jtok>
<jtok eid="13" type="method_call" span="363:15:363:22">println</jtok>
<jtok eid="13" type="string_literal" span="363:23:363:44">"Could not encode..."</jtok>
<jtok eid="13" type="primary_name_ref" span="365:3:365:5">ss</jtok>
<jtok eid="13" type="method_call" span="365:6:365:12">commit</jtok>
</jdoc>